<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RBHS Reunion</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'DM Sans', sans-serif;
      margin: 2rem;
      background: #f9f9f9;
    }
    .item {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
      padding: 1rem;
      transition: box-shadow 0.3s ease;
    }
    .item:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .profile {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }
    .profile img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 6px;
      flex-shrink: 0;
    }
    .profile-content {
      flex: 1;
    }
    .details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
      margin-top: 0.5rem;
      color: #555;
    }
    .item.active .details {
      max-height: 1000px;
    }
    .toggle {
      color: #0077cc;
      font-weight: 600;
      cursor: pointer;
      margin-top: 0.5rem;
      transition: color 0.3s ease;
    }
    .toggle:hover {
      color: #005fa3;
    }
  </style>
</head>
<body>
  <h1 style="display: flex; align-items: center; gap: 1rem;">
  <img src="https://via.placeholder.com/60x60.png?text=Logo" alt="RBHS Logo" style="border-radius: 8px;">
  Matric Class of 1966
  </h1>
  <div id="list">Loading...</div>

  <script>
    const jsonUrl = "https://script.google.com/macros/s/AKfycbxhtQNKlcrZSv1mDlvtSAr3baI1VSrFHUIuYyKbOSkOSZV842uu6ikmtI4aMexoxrLfgQ/exec";
    const placeholderImage = "https://via.placeholder.com/120x120.png?text=Logo";

    function isImageAccessible(url) {
      return new Promise(resolve => {
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = url;
      });
    }

    fetch(jsonUrl)
      .then(res => res.json())
      .then(async data => {
        const list = document.getElementById("list");
        list.innerHTML = "";

        for (const profile of data) {
          const item = document.createElement("div");
          item.className = "item";

          const imageUrl = profile["Upload a picture of you here:"] || "";
          const validImage = imageUrl && await isImageAccessible(imageUrl) ? imageUrl : placeholderImage;

          item.innerHTML = `
            <div class="profile">
              <img src="${validImage}" alt="${profile["Your Full Name"]}'s photo">
              <div class="profile-content">
                <strong>${profile["Your Full Name"] || "Unnamed"}</strong>
                <div class="details">
                  <p><b>His occupation is</b> ${profile["What is your current occupation?"]}</p>
                  <p><b>He currently lives in</b> ${profile["Where are you currently living?"]}</p>
                  <p><b>Some of his hobbies/interests are</b> ${profile["What are your main hobbies or interests outside of work?"]}</p>
                  <p><b>His most memorable achievement since Matric is</b> ${profile["What is your most memorable achievement since matric?"]}</p>
                  <p><b>Some of his other memorable achievements are:</b> ${profile["Any other memorable achievements? (sporting, music etc.)"]}</p>
                  <p><b>He is</b> ${profile["On a scale of 1-5, how excited are you to reconnect with your matric classmates?"]} / 5 <b>excited to reconnect with his classmates.</b></p>
                  <p><b>Something else he'd like to share is:</b> ${profile["Is there anything else you'd like to share with your classmates?"]}</p>
                </div>
                <div class="toggle">Click to show more details ↓</div>
              </div>
            </div>
          `;

          const toggle = item.querySelector(".toggle");
          toggle.addEventListener("click", () => {
            item.classList.toggle("active");
            toggle.textContent = item.classList.contains("active")
              ? "Click to show fewer details ↑"
              : "Click to show more details ↓";
          });

          list.appendChild(item);
        }
      })
      .catch(err => {
        document.getElementById("list").innerText = "Failed to load data.";
        console.error("JSON fetch error:", err);
      });
  </script>
</body>
</html>
